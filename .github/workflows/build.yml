name: Build Bundle

on:
  push:
    paths:
      - 'src/**/*.js'
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Bundle modules
        run: |
          cat \
            src/core/state.js \
            src/utils/helpers.js \
            src/core/router.js \
            src/ui/checkin.js \
            src/ui/stopwatch.js \
            src/ui/workouts.js \
            src/ui/analytics.js \
            src/ui/measurements.js \
            src/core/init.js \
            > app.js
          
          echo "Built app.js ($(wc -l < app.js) lines)"
      
      - name: Commit bundle
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add app.js
          git commit -m "Auto-build: Bundle modules to app.js" || echo "No changes"
          git push
